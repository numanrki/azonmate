(()=>{"use strict";var e={n:a=>{var t=a&&a.__esModule?()=>a.default:()=>a;return e.d(t,{a:t}),t},d:(a,t)=>{for(var n in t)e.o(t,n)&&!e.o(a,n)&&Object.defineProperty(a,n,{enumerable:!0,get:t[n]})},o:(e,a)=>Object.prototype.hasOwnProperty.call(e,a)};const a=window.React,t=window.wp.blocks,n=window.wp.i18n,o=window.wp.blockEditor,l=window.wp.components,r=window.wp.serverSideRender;var c=e.n(r);const i=window.wp.element,m=wp.element.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},wp.element.createElement("rect",{x:1,y:1,width:22,height:22,rx:4,fill:"#ff9900"}),wp.element.createElement("rect",{x:3,y:3,width:10,height:8,rx:1.5,fill:"#fff"}),wp.element.createElement("rect",{x:15,y:3,width:6,height:8,rx:1.5,fill:"#fff"}),wp.element.createElement("rect",{x:3,y:13,width:6,height:8,rx:1.5,fill:"#fff"}),wp.element.createElement("rect",{x:11,y:13,width:10,height:8,rx:1.5,fill:"#fff"}));(0,t.registerBlockType)("azonmate/collage",{icon:m,edit:function({attributes:e,setAttributes:t}){const{asins:r,max:s,heading:d,showBadge:p,showPrice:_,showRating:h,buttonText:u,gap:w}=e,g=(0,o.useBlockProps)(),[E,z]=(0,i.useState)(""),[b,f]=(0,i.useState)([]),[y,k]=(0,i.useState)(!1),[v,x]=(0,i.useState)(r?r.split(",").map(e=>e.trim()).filter(Boolean):[]),C=()=>{if(!E.trim())return;k(!0);const e=new FormData;e.append("action","azon_mate_search_products"),e.append("nonce",window.azonMateBlock?.nonce||""),e.append("keywords",E),fetch(window.azonMateBlock?.ajaxUrl||"/wp-admin/admin-ajax.php",{method:"POST",body:e}).then(e=>e.json()).then(e=>{k(!1),e.success&&e.data.products&&f(e.data.products)}).catch(()=>k(!1))},B=e=>{if(v.includes(e))return;const a=[...v,e];x(a),t({asins:a.join(",")})};return r?(0,a.createElement)("div",{...g},(0,a.createElement)(o.InspectorControls,null,(0,a.createElement)(l.PanelBody,{title:(0,n.__)("Collage Settings","azonmate")},(0,a.createElement)(l.RangeControl,{label:(0,n.__)("Max Products","azonmate"),value:s,onChange:e=>t({max:e}),min:1,max:20}),(0,a.createElement)(l.RangeControl,{label:(0,n.__)("Gap (px)","azonmate"),value:w,onChange:e=>t({gap:e}),min:0,max:40})),(0,a.createElement)(l.PanelBody,{title:(0,n.__)("Display Options","azonmate"),initialOpen:!1},(0,a.createElement)(l.TextControl,{label:(0,n.__)("Heading","azonmate"),value:d,onChange:e=>t({heading:e})}),(0,a.createElement)(l.ToggleControl,{label:(0,n.__)("Show Badge","azonmate"),checked:p,onChange:e=>t({showBadge:e})}),(0,a.createElement)(l.ToggleControl,{label:(0,n.__)("Show Price","azonmate"),checked:_,onChange:e=>t({showPrice:e})}),(0,a.createElement)(l.ToggleControl,{label:(0,n.__)("Show Rating","azonmate"),checked:h,onChange:e=>t({showRating:e})}),(0,a.createElement)(l.TextControl,{label:(0,n.__)("Button Text","azonmate"),value:u,onChange:e=>t({buttonText:e}),help:(0,n.__)("Leave empty for default.","azonmate")})),(0,a.createElement)(l.PanelBody,{title:(0,n.__)("Products","azonmate"),initialOpen:!1},(0,a.createElement)(l.TextControl,{label:(0,n.__)("ASINs (comma-separated)","azonmate"),value:r,onChange:e=>t({asins:e})}),(0,a.createElement)(l.Button,{variant:"secondary",isSmall:!0,onClick:()=>t({asins:""}),style:{marginBottom:"10px"}},(0,n.__)("Replace Products","azonmate")))),(0,a.createElement)("div",{className:"azonmate-editor-preview"},(0,a.createElement)("div",{className:"azonmate-editor-preview__toolbar"},(0,a.createElement)("span",{style:{fontWeight:600,color:"#ff9900"}},"ðŸ–¼ ",(0,n.__)("Collage","azonmate")," â€” ",r.split(",").filter(Boolean).length," ",(0,n.__)("products","azonmate")),(0,a.createElement)(l.Button,{variant:"tertiary",isSmall:!0,onClick:()=>t({asins:""})},(0,n.__)("Replace","azonmate"))),(0,a.createElement)(c(),{block:"azonmate/collage",attributes:e}))):(0,a.createElement)("div",{...g},(0,a.createElement)(l.Placeholder,{icon:m,label:(0,n.__)("AzonMate Collage","azonmate"),instructions:(0,n.__)("Search and add 2â€“12 products for a dynamic collage layout.","azonmate")},(0,a.createElement)("div",{className:"azonmate-block-search"},(0,a.createElement)("div",{className:"azonmate-block-search__input-row"},(0,a.createElement)(l.TextControl,{placeholder:(0,n.__)("Search productsâ€¦","azonmate"),value:E,onChange:z,onKeyDown:e=>"Enter"===e.key&&C()}),(0,a.createElement)(l.Button,{variant:"primary",onClick:C,disabled:y},y?(0,a.createElement)(l.Spinner,null):(0,n.__)("Search","azonmate")),(0,a.createElement)(l.Button,{variant:"secondary",onClick:()=>{k(!0);const e=new FormData;e.append("action","azon_mate_get_manual_products"),e.append("nonce",window.azonMateBlock?.nonce||""),e.append("search",E),fetch(window.azonMateBlock?.ajaxUrl||"/wp-admin/admin-ajax.php",{method:"POST",body:e}).then(e=>e.json()).then(e=>{k(!1),e.success&&e.data.products&&f(e.data.products)}).catch(()=>k(!1))},disabled:y},(0,n.__)("My Products","azonmate"))),(0,a.createElement)("div",{className:"azonmate-block-search__input-row"},(0,a.createElement)(l.TextControl,{placeholder:(0,n.__)("Or paste ASINs: B08N5WRWNW, B09V3KXJPB","azonmate"),onChange:e=>{e.trim()&&t({asins:e.trim()})}})),v.length>0&&(0,a.createElement)("div",{className:"azonmate-block-search__selected"},(0,a.createElement)("strong",null,(0,n.__)("Selected:","azonmate")),v.map(e=>(0,a.createElement)("span",{key:e,className:"azonmate-block-search__tag"},e,(0,a.createElement)("button",{type:"button",onClick:()=>(e=>{const a=v.filter(a=>a!==e);x(a),t({asins:a.join(",")})})(e)},"Ã—"))),(0,a.createElement)(l.Button,{variant:"primary",isSmall:!0,onClick:()=>t({asins:v.join(",")})},(0,n.__)("Done","azonmate"))),b.length>0&&(0,a.createElement)("div",{className:"azonmate-block-search__results"},b.map(e=>(0,a.createElement)("div",{key:e.asin,className:"azonmate-block-search__result",onClick:()=>B(e.asin),role:"button",tabIndex:0,onKeyDown:a=>"Enter"===a.key&&B(e.asin)},(e.image_medium||e.image_small||e.image)&&(0,a.createElement)("img",{src:e.image_medium||e.image_small||e.image,alt:""}),(0,a.createElement)("span",{className:"azonmate-block-search__result-title"},e.title),(e.price_display||e.price)&&(0,a.createElement)("span",{className:"azonmate-block-search__result-price"},e.price_display||e.price)))))))},save:()=>null})})();