(()=>{"use strict";var e={n:t=>{var a=t&&t.__esModule?()=>t.default:()=>t;return e.d(a,{a}),a},d:(t,a)=>{for(var n in a)e.o(a,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:a[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.wp.blocks,a=window.wp.i18n,n=window.wp.element,o=window.React,l=window.wp.blockEditor,r=window.wp.components,c=window.wp.serverSideRender;var i=e.n(c);window.wp.apiFetch;const m=wp.element.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},wp.element.createElement("rect",{x:1,y:1,width:22,height:22,rx:4,fill:"#ff9900"}),wp.element.createElement("path",{d:"M7 8h10M7 12h10M7 16h6",stroke:"#fff",strokeWidth:2,strokeLinecap:"round",fill:"none"})),s=(0,n.createElement)("svg",{width:24,height:24,viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},(0,n.createElement)("rect",{x:1,y:1,width:22,height:22,rx:4,fill:"#ff9900"}),(0,n.createElement)("path",{d:"M7 8h10M7 12h10M7 16h6",stroke:"#fff",strokeWidth:2,strokeLinecap:"round",fill:"none"}));(0,t.registerBlockType)("azonmate/product-box",{icon:s,edit:function({attributes:e,setAttributes:t}){const{asin:c,template:s,title:d,description:p,rating:_,price:h,buttonText:u,imageSize:w}=e,g=(0,l.useBlockProps)(),[z,b]=(0,n.useState)(""),[v,E]=(0,n.useState)([]),[k,C]=(0,n.useState)(!1),y=()=>{if(!z.trim())return;C(!0);const e=new FormData;e.append("action","azon_mate_search_products"),e.append("nonce",window.azonMateBlock?.nonce||""),e.append("keywords",z),fetch(window.azonMateBlock?.ajaxUrl||"/wp-admin/admin-ajax.php",{method:"POST",body:e}).then(e=>e.json()).then(e=>{C(!1),e.success&&e.data.products&&E(e.data.products)}).catch(()=>C(!1))},f=e=>{t({asin:e}),E([]),b("")};return c?(0,o.createElement)("div",{...g},(0,o.createElement)(l.InspectorControls,null,(0,o.createElement)(r.PanelBody,{title:(0,a.__)("Product Settings","azonmate")},(0,o.createElement)(r.TextControl,{label:(0,a.__)("ASIN","azonmate"),value:c,onChange:e=>t({asin:e})}),(0,o.createElement)(r.Button,{variant:"secondary",isSmall:!0,onClick:()=>t({asin:""}),style:{marginBottom:"16px"}},(0,a.__)("Replace Product","azonmate")),(0,o.createElement)(r.TextControl,{label:(0,a.__)("Custom Title","azonmate"),value:d,onChange:e=>t({title:e}),help:(0,a.__)("Leave empty to use the product title from Amazon.","azonmate")}),(0,o.createElement)(r.SelectControl,{label:(0,a.__)("Template","azonmate"),value:s,options:[{label:(0,a.__)("Default","azonmate"),value:"default"},{label:(0,a.__)("Horizontal","azonmate"),value:"horizontal"},{label:(0,a.__)("Compact","azonmate"),value:"compact"}],onChange:e=>t({template:e})}),(0,o.createElement)(r.SelectControl,{label:(0,a.__)("Image Size","azonmate"),value:w,options:[{label:(0,a.__)("Small","azonmate"),value:"small"},{label:(0,a.__)("Medium","azonmate"),value:"medium"},{label:(0,a.__)("Large","azonmate"),value:"large"}],onChange:e=>t({imageSize:e})})),(0,o.createElement)(r.PanelBody,{title:(0,a.__)("Display Options","azonmate"),initialOpen:!1},(0,o.createElement)(r.ToggleControl,{label:(0,a.__)("Show Description","azonmate"),checked:p,onChange:e=>t({description:e})}),(0,o.createElement)(r.ToggleControl,{label:(0,a.__)("Show Rating","azonmate"),checked:_,onChange:e=>t({rating:e})}),(0,o.createElement)(r.ToggleControl,{label:(0,a.__)("Show Price","azonmate"),checked:h,onChange:e=>t({price:e})}),(0,o.createElement)(r.TextControl,{label:(0,a.__)("Button Text","azonmate"),value:u,onChange:e=>t({buttonText:e}),help:(0,a.__)("Leave empty for default.","azonmate")}))),(0,o.createElement)("div",{className:"azonmate-editor-preview"},(0,o.createElement)("div",{className:"azonmate-editor-preview__toolbar"},(0,o.createElement)(r.Button,{variant:"tertiary",isSmall:!0,onClick:()=>t({asin:""})},(0,a.__)("Replace","azonmate"))),(0,o.createElement)(i(),{block:"azonmate/product-box",attributes:e}))):(0,o.createElement)("div",{...g},(0,o.createElement)(r.Placeholder,{icon:m,label:(0,a.__)("AzonMate Product Box","azonmate"),instructions:(0,a.__)("Search for an Amazon product or enter an ASIN.","azonmate")},(0,o.createElement)("div",{className:"azonmate-block-search"},(0,o.createElement)("div",{className:"azonmate-block-search__input-row"},(0,o.createElement)(r.TextControl,{placeholder:(0,a.__)("Search products or enter ASIN…","azonmate"),value:z,onChange:b,onKeyDown:e=>"Enter"===e.key&&y()}),(0,o.createElement)(r.Button,{variant:"primary",onClick:y,disabled:k},k?(0,o.createElement)(r.Spinner,null):(0,a.__)("Search","azonmate")),(0,o.createElement)(r.Button,{variant:"secondary",onClick:()=>{C(!0);const e=new FormData;e.append("action","azon_mate_get_manual_products"),e.append("nonce",window.azonMateBlock?.nonce||""),e.append("search",z),fetch(window.azonMateBlock?.ajaxUrl||"/wp-admin/admin-ajax.php",{method:"POST",body:e}).then(e=>e.json()).then(e=>{C(!1),e.success&&e.data.products&&E(e.data.products)}).catch(()=>C(!1))},disabled:k},(0,a.__)("My Products","azonmate"))),(0,o.createElement)("div",{className:"azonmate-block-search__input-row"},(0,o.createElement)(r.TextControl,{placeholder:(0,a.__)("Or paste ASIN directly…","azonmate"),onChange:e=>{/^[A-Z0-9]{10}$/i.test(e.trim())&&f(e.trim().toUpperCase())}})),v.length>0&&(0,o.createElement)("div",{className:"azonmate-block-search__results"},v.map(e=>(0,o.createElement)("div",{key:e.asin,className:"azonmate-block-search__result",onClick:()=>f(e.asin),role:"button",tabIndex:0,onKeyDown:t=>"Enter"===t.key&&f(e.asin)},(e.image_medium||e.image_small||e.image_large||e.image)&&(0,o.createElement)("img",{src:e.image_medium||e.image_small||e.image_large||e.image,alt:""}),(0,o.createElement)("span",{className:"azonmate-block-search__result-title"},e.title),(e.price_display||e.price)&&(0,o.createElement)("span",{className:"azonmate-block-search__result-price"},e.price_display||e.price)))))))},save:()=>null})})();