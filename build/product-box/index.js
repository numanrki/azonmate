(()=>{"use strict";var e={n:a=>{var t=a&&a.__esModule?()=>a.default:()=>a;return e.d(t,{a:t}),t},d:(a,t)=>{for(var n in t)e.o(t,n)&&!e.o(a,n)&&Object.defineProperty(a,n,{enumerable:!0,get:t[n]})},o:(e,a)=>Object.prototype.hasOwnProperty.call(e,a)};const a=window.wp.blocks,t=window.wp.i18n,n=window.React,o=window.wp.blockEditor,l=window.wp.components,r=window.wp.serverSideRender;var c=e.n(r);const i=window.wp.element;window.wp.apiFetch,(0,a.registerBlockType)("azonmate/product-box",{edit:function({attributes:e,setAttributes:a}){const{asin:r,template:m,title:s,description:d,rating:p,price:_,buttonText:u,imageSize:z}=e,h=(0,o.useBlockProps)(),[w,b]=(0,i.useState)(""),[g,v]=(0,i.useState)([]),[E,C]=(0,i.useState)(!1),k=()=>{if(!w.trim())return;C(!0);const e=new FormData;e.append("action","azon_mate_search_products"),e.append("nonce",window.azonMateBlock?.nonce||""),e.append("keywords",w),fetch(window.azonMateBlock?.ajaxUrl||"/wp-admin/admin-ajax.php",{method:"POST",body:e}).then(e=>e.json()).then(e=>{C(!1),e.success&&e.data.products&&v(e.data.products)}).catch(()=>C(!1))},y=e=>{a({asin:e}),v([]),b("")};return r?(0,n.createElement)("div",{...h},(0,n.createElement)(o.InspectorControls,null,(0,n.createElement)(l.PanelBody,{title:(0,t.__)("Product Settings","azonmate")},(0,n.createElement)(l.TextControl,{label:(0,t.__)("ASIN","azonmate"),value:r,onChange:e=>a({asin:e})}),(0,n.createElement)(l.Button,{variant:"secondary",isSmall:!0,onClick:()=>a({asin:""}),style:{marginBottom:"16px"}},(0,t.__)("Replace Product","azonmate")),(0,n.createElement)(l.TextControl,{label:(0,t.__)("Custom Title","azonmate"),value:s,onChange:e=>a({title:e}),help:(0,t.__)("Leave empty to use the product title from Amazon.","azonmate")}),(0,n.createElement)(l.SelectControl,{label:(0,t.__)("Template","azonmate"),value:m,options:[{label:(0,t.__)("Default","azonmate"),value:"default"},{label:(0,t.__)("Horizontal","azonmate"),value:"horizontal"},{label:(0,t.__)("Compact","azonmate"),value:"compact"}],onChange:e=>a({template:e})}),(0,n.createElement)(l.SelectControl,{label:(0,t.__)("Image Size","azonmate"),value:z,options:[{label:(0,t.__)("Small","azonmate"),value:"small"},{label:(0,t.__)("Medium","azonmate"),value:"medium"},{label:(0,t.__)("Large","azonmate"),value:"large"}],onChange:e=>a({imageSize:e})})),(0,n.createElement)(l.PanelBody,{title:(0,t.__)("Display Options","azonmate"),initialOpen:!1},(0,n.createElement)(l.ToggleControl,{label:(0,t.__)("Show Description","azonmate"),checked:d,onChange:e=>a({description:e})}),(0,n.createElement)(l.ToggleControl,{label:(0,t.__)("Show Rating","azonmate"),checked:p,onChange:e=>a({rating:e})}),(0,n.createElement)(l.ToggleControl,{label:(0,t.__)("Show Price","azonmate"),checked:_,onChange:e=>a({price:e})}),(0,n.createElement)(l.TextControl,{label:(0,t.__)("Button Text","azonmate"),value:u,onChange:e=>a({buttonText:e}),help:(0,t.__)("Leave empty for default.","azonmate")}))),(0,n.createElement)("div",{className:"azonmate-editor-preview"},(0,n.createElement)("div",{className:"azonmate-editor-preview__toolbar"},(0,n.createElement)(l.Button,{variant:"tertiary",isSmall:!0,onClick:()=>a({asin:""})},(0,t.__)("Replace","azonmate"))),(0,n.createElement)(c(),{block:"azonmate/product-box",attributes:e}))):(0,n.createElement)("div",{...h},(0,n.createElement)(l.Placeholder,{icon:"cart",label:(0,t.__)("AzonMate Product Box","azonmate"),instructions:(0,t.__)("Search for an Amazon product or enter an ASIN.","azonmate")},(0,n.createElement)("div",{className:"azonmate-block-search"},(0,n.createElement)("div",{className:"azonmate-block-search__input-row"},(0,n.createElement)(l.TextControl,{placeholder:(0,t.__)("Search products or enter ASIN…","azonmate"),value:w,onChange:b,onKeyDown:e=>"Enter"===e.key&&k()}),(0,n.createElement)(l.Button,{variant:"primary",onClick:k,disabled:E},E?(0,n.createElement)(l.Spinner,null):(0,t.__)("Search","azonmate")),(0,n.createElement)(l.Button,{variant:"secondary",onClick:()=>{C(!0);const e=new FormData;e.append("action","azon_mate_get_manual_products"),e.append("nonce",window.azonMateBlock?.nonce||""),e.append("search",w),fetch(window.azonMateBlock?.ajaxUrl||"/wp-admin/admin-ajax.php",{method:"POST",body:e}).then(e=>e.json()).then(e=>{C(!1),e.success&&e.data.products&&v(e.data.products)}).catch(()=>C(!1))},disabled:E},(0,t.__)("My Products","azonmate"))),(0,n.createElement)("div",{className:"azonmate-block-search__input-row"},(0,n.createElement)(l.TextControl,{placeholder:(0,t.__)("Or paste ASIN directly…","azonmate"),onChange:e=>{/^[A-Z0-9]{10}$/i.test(e.trim())&&y(e.trim().toUpperCase())}})),g.length>0&&(0,n.createElement)("div",{className:"azonmate-block-search__results"},g.map(e=>(0,n.createElement)("div",{key:e.asin,className:"azonmate-block-search__result",onClick:()=>y(e.asin),role:"button",tabIndex:0,onKeyDown:a=>"Enter"===a.key&&y(e.asin)},(e.image_medium||e.image_small||e.image_large||e.image)&&(0,n.createElement)("img",{src:e.image_medium||e.image_small||e.image_large||e.image,alt:""}),(0,n.createElement)("span",{className:"azonmate-block-search__result-title"},e.title),(e.price_display||e.price)&&(0,n.createElement)("span",{className:"azonmate-block-search__result-price"},e.price_display||e.price)))))))},save:()=>null})})();