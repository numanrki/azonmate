(()=>{"use strict";var e={n:t=>{var a=t&&t.__esModule?()=>t.default:()=>t;return e.d(a,{a}),a},d:(t,a)=>{for(var n in a)e.o(a,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:a[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.wp.blocks,a=window.wp.i18n,n=window.wp.blockEditor,o=window.wp.components,l=window.wp.serverSideRender;var r=e.n(l);const c=window.wp.element,i=(0,c.createElement)("svg",{width:24,height:24,viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},(0,c.createElement)("rect",{x:1,y:1,width:22,height:22,rx:4,fill:"#ff9900"}),(0,c.createElement)("rect",{x:4,y:4,width:7,height:7,rx:1,fill:"#fff"}),(0,c.createElement)("rect",{x:13,y:4,width:7,height:7,rx:1,fill:"#fff"}),(0,c.createElement)("rect",{x:4,y:13,width:7,height:7,rx:1,fill:"#fff"}),(0,c.createElement)("rect",{x:13,y:13,width:7,height:7,rx:1,fill:"#fff"}));(0,t.registerBlockType)("azonmate/comparison-table",{icon:i,edit:function({attributes:e,setAttributes:t}){const{asins:l,columns:s,highlight:m,max:d,template:p}=e,h=(0,n.useBlockProps)(),[_,u]=(0,c.useState)(""),[w,g]=(0,c.useState)([]),[E,b]=(0,c.useState)(!1),[z,v]=(0,c.useState)(l?l.split(",").map(e=>e.trim()).filter(Boolean):[]),f=()=>{if(!_.trim())return;b(!0);const e=new FormData;e.append("action","azon_mate_search_products"),e.append("nonce",window.azonMateBlock?.nonce||""),e.append("keywords",_),fetch(window.azonMateBlock?.ajaxUrl||"/wp-admin/admin-ajax.php",{method:"POST",body:e}).then(e=>e.json()).then(e=>{b(!1),e.success&&e.data.products&&g(e.data.products)}).catch(()=>b(!1))},k=e=>{if(z.includes(e))return;const a=[...z,e];v(a),t({asins:a.join(",")})};return l?(0,c.createElement)("div",{...h},(0,c.createElement)(n.InspectorControls,null,(0,c.createElement)(o.PanelBody,{title:(0,a.__)("Table Settings","azonmate")},(0,c.createElement)(o.TextControl,{label:(0,a.__)("ASINs (comma-separated)","azonmate"),value:l,onChange:e=>t({asins:e})}),(0,c.createElement)(o.Button,{variant:"secondary",isSmall:!0,onClick:()=>t({asins:""}),style:{marginBottom:"16px"}},(0,a.__)("Replace Products","azonmate")),(0,c.createElement)(o.TextControl,{label:(0,a.__)("Columns","azonmate"),value:s,onChange:e=>t({columns:e}),help:(0,a.__)("e.g. image,title,price,rating,prime,button. Leave empty for all.","azonmate")}),(0,c.createElement)(o.TextControl,{label:(0,a.__)("Highlight ASIN","azonmate"),value:m,onChange:e=>t({highlight:e}),help:(0,a.__)('ASIN of the product to highlight as "Best Pick".',"azonmate")}),(0,c.createElement)(o.RangeControl,{label:(0,a.__)("Max Products","azonmate"),value:d,onChange:e=>t({max:e}),min:2,max:10}))),(0,c.createElement)("div",{className:"azonmate-editor-preview"},(0,c.createElement)("div",{className:"azonmate-editor-preview__toolbar"},(0,c.createElement)(o.Button,{variant:"tertiary",isSmall:!0,onClick:()=>t({asins:""})},(0,a.__)("Replace","azonmate"))),(0,c.createElement)(r(),{block:"azonmate/comparison-table",attributes:e}))):(0,c.createElement)("div",{...h},(0,c.createElement)(o.Placeholder,{icon:i,label:(0,a.__)("AzonMate Comparison Table","azonmate"),instructions:(0,a.__)("Search and add products to compare, or enter comma-separated ASINs.","azonmate")},(0,c.createElement)("div",{className:"azonmate-block-search"},(0,c.createElement)("div",{className:"azonmate-block-search__input-row"},(0,c.createElement)(o.TextControl,{placeholder:(0,a.__)("Search products…","azonmate"),value:_,onChange:u,onKeyDown:e=>"Enter"===e.key&&f()}),(0,c.createElement)(o.Button,{variant:"primary",onClick:f,disabled:E},E?(0,c.createElement)(o.Spinner,null):(0,a.__)("Search","azonmate")),(0,c.createElement)(o.Button,{variant:"secondary",onClick:()=>{b(!0);const e=new FormData;e.append("action","azon_mate_get_manual_products"),e.append("nonce",window.azonMateBlock?.nonce||""),e.append("search",_),fetch(window.azonMateBlock?.ajaxUrl||"/wp-admin/admin-ajax.php",{method:"POST",body:e}).then(e=>e.json()).then(e=>{b(!1),e.success&&e.data.products&&g(e.data.products)}).catch(()=>b(!1))},disabled:E},(0,a.__)("My Products","azonmate"))),(0,c.createElement)("div",{className:"azonmate-block-search__input-row"},(0,c.createElement)(o.TextControl,{placeholder:(0,a.__)("Or paste ASINs: B08N5WRWNW, B09V3KXJPB","azonmate"),onChange:e=>{e.trim()&&t({asins:e.trim()})}})),z.length>0&&(0,c.createElement)("div",{className:"azonmate-block-search__selected"},(0,c.createElement)("strong",null,(0,a.__)("Selected:","azonmate")),z.map(e=>(0,c.createElement)("span",{key:e,className:"azonmate-block-search__tag"},e,(0,c.createElement)("button",{type:"button",onClick:()=>(e=>{const a=z.filter(t=>t!==e);v(a),t({asins:a.join(",")})})(e)},"×"))),(0,c.createElement)(o.Button,{variant:"primary",isSmall:!0,onClick:()=>t({asins:z.join(",")})},(0,a.__)("Done","azonmate"))),w.length>0&&(0,c.createElement)("div",{className:"azonmate-block-search__results"},w.map(e=>(0,c.createElement)("div",{key:e.asin,className:"azonmate-block-search__result",onClick:()=>k(e.asin),role:"button",tabIndex:0,onKeyDown:t=>"Enter"===t.key&&k(e.asin)},(e.image_medium||e.image_small||e.image)&&(0,c.createElement)("img",{src:e.image_medium||e.image_small||e.image,alt:""}),(0,c.createElement)("span",{className:"azonmate-block-search__result-title"},e.title),(e.price_display||e.price)&&(0,c.createElement)("span",{className:"azonmate-block-search__result-price"},e.price_display||e.price)))))))},save:()=>null})})();