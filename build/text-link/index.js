(()=>{"use strict";var e={n:t=>{var a=t&&t.__esModule?()=>t.default:()=>t;return e.d(a,{a}),a},d:(t,a)=>{for(var n in a)e.o(a,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:a[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.React,a=window.wp.blocks,n=window.wp.i18n,o=window.wp.blockEditor,r=window.wp.components,l=window.wp.serverSideRender;var c=e.n(l);const i=window.wp.element;(0,a.registerBlockType)("azonmate/text-link",{edit:function({attributes:e,setAttributes:a}){const{asin:l,title:s,text:m}=e,d=(0,o.useBlockProps)(),[p,_]=(0,i.useState)(""),[u,w]=(0,i.useState)([]),[h,k]=(0,i.useState)(!1),z=()=>{if(!p.trim())return;k(!0);const e=new FormData;e.append("action","azon_mate_search_products"),e.append("nonce",window.azonMateBlock?.nonce||""),e.append("keywords",p),fetch(window.azonMateBlock?.ajaxUrl||"/wp-admin/admin-ajax.php",{method:"POST",body:e}).then(e=>e.json()).then(e=>{k(!1),e.success&&e.data.products&&w(e.data.products)}).catch(()=>k(!1))},E=e=>{a({asin:e}),w([]),_("")};return l?(0,t.createElement)("div",{...d},(0,t.createElement)(o.InspectorControls,null,(0,t.createElement)(r.PanelBody,{title:(0,n.__)("Link Settings","azonmate")},(0,t.createElement)(r.TextControl,{label:(0,n.__)("ASIN","azonmate"),value:l,onChange:e=>a({asin:e})}),(0,t.createElement)(r.Button,{variant:"secondary",isSmall:!0,onClick:()=>a({asin:""}),style:{marginBottom:"16px"}},(0,n.__)("Replace Product","azonmate")),(0,t.createElement)(r.TextControl,{label:(0,n.__)("Link Text","azonmate"),value:m,onChange:e=>a({text:e}),help:(0,n.__)("Custom text for the link.","azonmate")}),(0,t.createElement)(r.TextControl,{label:(0,n.__)("Title Attribute","azonmate"),value:s,onChange:e=>a({title:e})}))),(0,t.createElement)("div",{className:"azonmate-editor-preview"},(0,t.createElement)("div",{className:"azonmate-editor-preview__toolbar"},(0,t.createElement)(r.Button,{variant:"tertiary",isSmall:!0,onClick:()=>a({asin:""})},(0,n.__)("Replace","azonmate"))),(0,t.createElement)(c(),{block:"azonmate/text-link",attributes:e}))):(0,t.createElement)("div",{...d},(0,t.createElement)(r.Placeholder,{icon:"admin-links",label:(0,n.__)("AzonMate Text Link","azonmate"),instructions:(0,n.__)("Search for a product or enter an ASIN.","azonmate")},(0,t.createElement)("div",{className:"azonmate-block-search"},(0,t.createElement)("div",{className:"azonmate-block-search__input-row"},(0,t.createElement)(r.TextControl,{placeholder:(0,n.__)("Search products or enter ASIN…","azonmate"),value:p,onChange:_,onKeyDown:e=>"Enter"===e.key&&z()}),(0,t.createElement)(r.Button,{variant:"primary",onClick:z,disabled:h},h?(0,t.createElement)(r.Spinner,null):(0,n.__)("Search","azonmate")),(0,t.createElement)(r.Button,{variant:"secondary",onClick:()=>{k(!0);const e=new FormData;e.append("action","azon_mate_get_manual_products"),e.append("nonce",window.azonMateBlock?.nonce||""),e.append("search",p),fetch(window.azonMateBlock?.ajaxUrl||"/wp-admin/admin-ajax.php",{method:"POST",body:e}).then(e=>e.json()).then(e=>{k(!1),e.success&&e.data.products&&w(e.data.products)}).catch(()=>k(!1))},disabled:h},(0,n.__)("My Products","azonmate"))),(0,t.createElement)("div",{className:"azonmate-block-search__input-row"},(0,t.createElement)(r.TextControl,{placeholder:(0,n.__)("Or paste ASIN directly…","azonmate"),onChange:e=>{/^[A-Z0-9]{10}$/i.test(e.trim())&&E(e.trim().toUpperCase())}})),u.length>0&&(0,t.createElement)("div",{className:"azonmate-block-search__results"},u.map(e=>(0,t.createElement)("div",{key:e.asin,className:"azonmate-block-search__result",onClick:()=>E(e.asin),role:"button",tabIndex:0,onKeyDown:t=>"Enter"===t.key&&E(e.asin)},(e.image_medium||e.image_small||e.image)&&(0,t.createElement)("img",{src:e.image_medium||e.image_small||e.image,alt:""}),(0,t.createElement)("span",{className:"azonmate-block-search__result-title"},e.title),(e.price_display||e.price)&&(0,t.createElement)("span",{className:"azonmate-block-search__result-price"},e.price_display||e.price)))))))},save:()=>null})})();