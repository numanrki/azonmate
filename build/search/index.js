(()=>{"use strict";var e={n:a=>{var t=a&&a.__esModule?()=>a.default:()=>a;return e.d(t,{a:t}),t},d:(a,t)=>{for(var n in t)e.o(t,n)&&!e.o(a,n)&&Object.defineProperty(a,n,{enumerable:!0,get:t[n]})},o:(e,a)=>Object.prototype.hasOwnProperty.call(e,a)};const a=window.wp.blocks,t=window.wp.i18n,n=window.wp.blockEditor,o=window.wp.components,l=window.wp.serverSideRender;var r=e.n(l);const c=window.wp.element,i=(0,c.createElement)("svg",{width:24,height:24,viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},(0,c.createElement)("rect",{x:1,y:1,width:22,height:22,rx:4,fill:"#ff9900"}),(0,c.createElement)("circle",{cx:11,cy:11,r:4,stroke:"#fff",strokeWidth:2,fill:"none"}),(0,c.createElement)("line",{x1:14,y1:14,x2:18,y2:18,stroke:"#fff",strokeWidth:2,strokeLinecap:"round"}));(0,a.registerBlockType)("azonmate/search",{icon:i,edit:function({attributes:e,setAttributes:a}){const{asin:l,displayType:s,template:m}=e,d=(0,n.useBlockProps)(),[p,_]=(0,c.useState)(""),[u,h]=(0,c.useState)([]),[w,z]=(0,c.useState)(!1),b=()=>{if(!p.trim())return;z(!0);const e=new FormData;e.append("action","azon_mate_search_products"),e.append("nonce",window.azonMateBlock?.nonce||""),e.append("keywords",p),fetch(window.azonMateBlock?.ajaxUrl||"/wp-admin/admin-ajax.php",{method:"POST",body:e}).then(e=>e.json()).then(e=>{z(!1),e.success&&e.data.products&&h(e.data.products)}).catch(()=>z(!1))},v=e=>{a({asin:e}),h([]),_("")};return l?(0,c.createElement)("div",{...d},(0,c.createElement)(n.InspectorControls,null,(0,c.createElement)(o.PanelBody,{title:(0,t.__)("Product Settings","azonmate")},(0,c.createElement)(o.TextControl,{label:(0,t.__)("ASIN","azonmate"),value:l,onChange:e=>a({asin:e})}),(0,c.createElement)(o.Button,{variant:"secondary",isSmall:!0,onClick:()=>a({asin:""}),style:{marginBottom:"16px"}},(0,t.__)("Replace Product","azonmate")),(0,c.createElement)(o.SelectControl,{label:(0,t.__)("Display Type","azonmate"),value:s,options:[{label:(0,t.__)("Product Box","azonmate"),value:"box"},{label:(0,t.__)("Text Link","azonmate"),value:"link"},{label:(0,t.__)("Image Link","azonmate"),value:"image"}],onChange:e=>a({displayType:e})}),(0,c.createElement)(o.SelectControl,{label:(0,t.__)("Template","azonmate"),value:m,options:[{label:(0,t.__)("Default","azonmate"),value:"default"},{label:(0,t.__)("Horizontal","azonmate"),value:"horizontal"},{label:(0,t.__)("Compact","azonmate"),value:"compact"}],onChange:e=>a({template:e})}))),(0,c.createElement)("div",{className:"azonmate-editor-preview"},(0,c.createElement)("div",{className:"azonmate-editor-preview__toolbar"},(0,c.createElement)(o.Button,{variant:"tertiary",isSmall:!0,onClick:()=>a({asin:""})},(0,t.__)("Replace","azonmate"))),(0,c.createElement)(r(),{block:"azonmate/search",attributes:e}))):(0,c.createElement)("div",{...d},(0,c.createElement)(o.Placeholder,{icon:i,label:(0,t.__)("AzonMate Product Search","azonmate"),instructions:(0,t.__)("Search Amazon or browse your saved products. Select a product and choose how to display it.","azonmate")},(0,c.createElement)("div",{className:"azonmate-block-search"},(0,c.createElement)("div",{className:"azonmate-block-search__input-row"},(0,c.createElement)(o.TextControl,{placeholder:(0,t.__)("Search Amazon products…","azonmate"),value:p,onChange:_,onKeyDown:e=>"Enter"===e.key&&b()}),(0,c.createElement)(o.Button,{variant:"primary",onClick:b,disabled:w},w?(0,c.createElement)(o.Spinner,null):(0,t.__)("Search","azonmate")),(0,c.createElement)(o.Button,{variant:"secondary",onClick:()=>{z(!0);const e=new FormData;e.append("action","azon_mate_get_manual_products"),e.append("nonce",window.azonMateBlock?.nonce||""),e.append("search",p),fetch(window.azonMateBlock?.ajaxUrl||"/wp-admin/admin-ajax.php",{method:"POST",body:e}).then(e=>e.json()).then(e=>{z(!1),e.success&&e.data.products&&h(e.data.products)}).catch(()=>z(!1))},disabled:w},(0,t.__)("My Products","azonmate"))),(0,c.createElement)("div",{className:"azonmate-block-search__input-row"},(0,c.createElement)(o.TextControl,{placeholder:(0,t.__)("Or paste ASIN directly…","azonmate"),onChange:e=>{/^[A-Z0-9]{10}$/i.test(e.trim())&&v(e.trim().toUpperCase())}})),(0,c.createElement)("div",{className:"azonmate-block-search__display-type"},(0,c.createElement)(o.SelectControl,{label:(0,t.__)("Display as","azonmate"),value:s,options:[{label:(0,t.__)("Product Box","azonmate"),value:"box"},{label:(0,t.__)("Text Link","azonmate"),value:"link"},{label:(0,t.__)("Image Link","azonmate"),value:"image"}],onChange:e=>a({displayType:e})})),u.length>0&&(0,c.createElement)("div",{className:"azonmate-block-search__results"},u.map(e=>(0,c.createElement)("div",{key:e.asin,className:"azonmate-block-search__result",onClick:()=>v(e.asin),role:"button",tabIndex:0,onKeyDown:a=>"Enter"===a.key&&v(e.asin)},(e.image_medium||e.image_small||e.image)&&(0,c.createElement)("img",{src:e.image_medium||e.image_small||e.image,alt:""}),(0,c.createElement)("span",{className:"azonmate-block-search__result-title"},e.title),(e.price_display||e.price)&&(0,c.createElement)("span",{className:"azonmate-block-search__result-price"},e.price_display||e.price)))))))},save:()=>null})})();